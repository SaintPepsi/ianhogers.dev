---
// CollageItem.astro — photo-effect wrapper for any element
// Applies rotation, shadow, hover-lift to whatever it wraps.
// Props override defaults; without props, nth-child provides auto-variation.
interface Props {
  rotate?: number;    // degrees, e.g. -3, 5, 15
  offsetY?: string;   // CSS value, e.g. "1rem", "-0.5rem"
  width?: string;     // CSS value, e.g. "280px", "100%"
  class?: string;     // additional classes
}
const { rotate, offsetY, width, class: className = '' } = Astro.props;

const style = [
  rotate !== undefined ? `--ci-rotate: ${rotate}deg` : '',
  offsetY ? `--ci-offset-y: ${offsetY}` : '',
  width ? `--ci-width: ${width}` : '',
].filter(Boolean).join('; ');
---

<div
  class:list={['collage-item', { 'collage-item--custom-rotate': rotate !== undefined }, className]}
  style={style || undefined}
>
  <slot />
</div>

<style>
  .collage-item {
    width: var(--ci-width, 220px);
    margin: -0.25rem;
    position: relative;
    z-index: 1;
    cursor: pointer;
    transform:
      rotate(var(--ci-rotate, 0deg))
      translateY(var(--ci-offset-y, 0px));
    transition:
      transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1),
      z-index 0s,
      box-shadow 0.3s ease;
    border-radius: 0.5rem;
    box-shadow:
      0 4px 16px rgba(0, 0, 0, 0.5),
      0 0 0 3px #1e1a28,
      0 0 0 4px rgba(255, 255, 255, 0.08);
    overflow: hidden;
    flex-shrink: 0;
  }

  /* Auto-rotation via nth-child when no explicit rotate prop */
  .collage-item:not(.collage-item--custom-rotate):nth-child(4n+1) { --ci-rotate: -3deg; }
  .collage-item:not(.collage-item--custom-rotate):nth-child(4n+2) { --ci-rotate: 2.5deg; }
  .collage-item:not(.collage-item--custom-rotate):nth-child(4n+3) { --ci-rotate: -1.5deg; }
  .collage-item:not(.collage-item--custom-rotate):nth-child(4n)   { --ci-rotate: 4deg; }

  /* Auto vertical variation via nth-child */
  .collage-item:nth-child(odd)  { --ci-offset-y: 0px; }
  .collage-item:nth-child(even) { --ci-offset-y: 1rem; }
  .collage-item:nth-child(3n)   { --ci-offset-y: 0.5rem; }

  /* Override auto-offset when explicit offsetY is set */
  .collage-item[style*="--ci-offset-y"] {
    /* explicit value wins via specificity of inline style */
  }

  /* Hover: lift to front, straighten, scale */
  .collage-item:hover {
    transform: rotate(0deg) translateY(var(--ci-offset-y, 0px)) scale(1.06);
    z-index: 10;
    box-shadow:
      0 12px 40px rgba(0, 0, 0, 0.7),
      0 0 0 3px #1e1a28,
      0 0 0 4px var(--accent, #f59e0b);
  }

  /* Images inside fill their wrapper */
  .collage-item :global(img) {
    width: 100%;
    height: auto;
    display: block;
    margin: 0;
    border-radius: 0;
  }

  /* Pixel-box children: remove their own shadow to avoid doubling */
  .collage-item :global(.pixel-box) {
    box-shadow: none;
  }

  /* Captions */
  .collage-item :global(p) {
    margin: 0;
  }

  /* ── Responsive sizing ── */
  @media (min-width: 640px) {
    .collage-item { width: var(--ci-width, 240px); }
  }
  @media (min-width: 768px) {
    .collage-item { width: var(--ci-width, 280px); margin: -0.5rem; }
  }
  @media (min-width: 1024px) {
    .collage-item { width: var(--ci-width, 320px); }
  }
</style>
